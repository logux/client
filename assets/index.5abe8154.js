(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();let L=()=>({events:{},emit(i,...e){let t=this.events[i]||[];for(let s=0,n=t.length;s<n;s++)t[s](...e)},on(i,e){var t;return(t=this.events[i])!=null&&t.push(e)||(this.events[i]=[e]),()=>{var s;this.events[i]=(s=this.events[i])==null?void 0:s.filter(n=>e!==n)}}});function I(i,e,t,s){t.id&&i.emit(`${e}-${t.type}-${t.id}`,t,s),i.emit(`${e}-${t.type}-`,t,s),i.emit(e,t,s)}class ${constructor(e={}){this.nodeId=e.nodeId,this.lastTime=0,this.sequence=0,this.store=e.store,this.emitter=L()}on(e,t){return this.emitter.on(e,t)}type(e,t,s={}){let n=s.event||"add",o=s.id||"";return this.emitter.on(`${n}-${e}-${o}`,t)}async add(e,t={}){if(typeof e.type>"u")throw new Error('Expected "type" in action');let s=!1;if(typeof t.id>"u"&&(s=!0,t.id=this.generateId()),typeof t.time>"u"&&(t.time=parseInt(t.id)),typeof t.reasons>"u"&&(t.reasons=[]),I(this.emitter,"preadd",e,t),t.keepLast&&(this.removeReason(t.keepLast,{olderThan:t}),t.reasons.push(t.keepLast)),t.reasons.length===0&&s)return I(this.emitter,"add",e,t),I(this.emitter,"clean",e,t),t;if(t.reasons.length===0){let[n]=await this.store.byId(t.id);return n?!1:(I(this.emitter,"add",e,t),I(this.emitter,"clean",e,t),t)}else{let n=await this.store.add(e,t);return n===!1?!1:(I(this.emitter,"add",e,t),n)}}generateId(){let e=Date.now();return e<=this.lastTime?(e=this.lastTime,this.sequence+=1):(this.lastTime=e,this.sequence=0),e+" "+this.nodeId+" "+this.sequence}each(e,t){t||(t=e,e={order:"created"});let s=this.store;return new Promise(n=>{async function o(d){let l=await d(),r;for(let c=l.entries.length-1;c>=0;c--){let a=l.entries[c];if(r=t(a[0],a[1]),r===!1)break}r===!1||!l.next?n():o(l.next)}o(s.get.bind(s,e))})}async changeMeta(e,t){for(let s in t)if(s==="id"||s==="added"||s==="time"||s==="subprotocol"||s==="indexes")throw new Error('Meta "'+s+'" is read-only');if(t.reasons&&t.reasons.length===0){let s=await this.store.remove(e);if(s){for(let n in t)s[1][n]=t[n];I(this.emitter,"clean",s[0],s[1])}return!!s}else return this.store.changeMeta(e,t)}removeReason(e,t={}){return this.store.removeReason(e,t,(s,n)=>{I(this.emitter,"clean",s,n)})}byId(e){return this.store.byId(e)}}class he{constructor(e,t,s){if(this.connected=!1,this.emitter=L(),t)this.Class=t;else if(typeof WebSocket<"u")this.Class=WebSocket;else throw new Error("No WebSocket support");this.url=e,this.opts=s}init(e){e.onerror=t=>{this.emitter.emit("error",t.error||new Error("WS Error"))},e.onclose=()=>{this.onclose()},e.onmessage=t=>{let s;try{s=JSON.parse(t.data)}catch{this.error(t.data);return}this.emitter.emit("message",s)},this.ws=e}connect(){return this.ws?Promise.resolve():(this.emitter.emit("connecting"),this.init(new this.Class(this.url,void 0,this.opts)),new Promise(e=>{this.ws.onopen=()=>{this.connected=!0,this.emitter.emit("connect"),e()}}))}disconnect(){this.ws&&(this.ws.onclose=void 0,this.ws.close(),this.onclose())}on(e,t){return this.emitter.on(e,t)}send(e){this.ws&&this.ws.readyState===this.ws.OPEN?this.ws.send(JSON.stringify(e)):this.emitter.emit("error",new Error("WS was closed"))}error(e){let t=new Error("Wrong message format");t.received=e,this.emitter.emit("error",t)}onclose(){this.ws&&(this.connected=!1,this.emitter.emit("disconnect"),this.ws=void 0)}}function T(i,e){if(i&&!e)return!1;if(!i&&e)return!0;if(typeof i=="string"&&(i={id:i,time:parseInt(i)}),typeof e=="string"&&(e={id:e,time:parseInt(e)}),i.time>e.time)return!1;if(i.time<e.time)return!0;let t=i.id.split(" "),s=e.id.split(" "),n=t[1],o=s[1];if(n>o)return!1;if(n<o)return!0;let d=parseInt(t[2]),l=parseInt(s[2]);if(d>l)return!1;if(d<l)return!0;let r=parseInt(t[0]),c=parseInt(s[0]);return r>c?!1:r<c}function R(i,e){i.indexes[e]||(i.indexes[e]={added:[],entries:[]})}function v(i,e){let t=i.indexes;if(x(t)&&t.length>0)for(let s of t)e(s)}function M(i,e){return i.lastAdded+=1,e[1].added=i.lastAdded,i.added.push(e),v(e[1],t=>{R(i,t),i.indexes[t].added.push(e)}),Promise.resolve(e[1])}function Q(i,e){let t=e.added,s=0,n=i.added.length-1;for(;s<=n;){let o=n+s>>1,d=i.added[o][1].added;if(d<t)s=o+1;else if(d>t)n=o-1;else{i.added.splice(o,1);break}}}function E(i,e){for(let t=i.length-1;t>=0;t--)if(e===i[t][1].id)return t;return-1}function x(i){return typeof i<"u"}class _{constructor(){this.entries=[],this.added=[],this.indexes={},this.lastReceived=0,this.lastAdded=0,this.lastSent=0}async add(e,t){let s=[e,t],n=t.id,o=this.entries;for(let d=0;d<o.length;d++){let[,l]=o[d];if(n===l.id)return!1;if(!T(l,t))return v(t,r=>{R(this,r);let c=this.indexes[r].entries,a=c.findIndex(A=>!T(A[1],t));c.splice(a,0,s)}),o.splice(d,0,s),M(this,s)}return v(t,d=>{R(this,d),this.indexes[d].entries.push(s)}),o.push(s),M(this,s)}async byId(e){let t=E(this.entries,e);if(t===-1)return[null,null];{let[s,n]=this.entries[t];return[s,n]}}async remove(e,t){if(typeof t>"u"&&(t=E(this.entries,e),t===-1))return Promise.resolve(!1);let s=[this.entries[t][0],this.entries[t][1]];return v(s[1],n=>{let o=this.indexes[n].entries,d=E(o,e);d!==-1&&o.splice(d,1)}),this.entries.splice(t,1),v(s[1],n=>{Q(this.indexes[n],s[1])}),Q(this,s[1]),s}async get(e={}){let t=e.index,s=this,n;return t&&(s=this.indexes[t]||{added:[],entries:[]}),e.order==="created"?n=s.entries:n=s.added,{entries:n.slice(0)}}async changeMeta(e,t){let s=E(this.entries,e);if(s===-1)return!1;{let n=this.entries[s][1];for(let o in t)n[o]=t[o];return!0}}async removeReason(e,t,s){let n=[];if(t.id){let o=E(this.entries,t.id);if(o!==-1){let d=this.entries[o][1],l=d.reasons.indexOf(e);l!==-1&&(d.reasons.splice(l,1),d.reasons.length===0&&(s(this.entries[o][0],d),this.remove(t.id)))}}else{this.entries=this.entries.filter(([l,r])=>{let c=t,a=r.reasons.indexOf(e);return a===-1||x(c.olderThan)&&!T(r,c.olderThan)||x(c.youngerThan)&&!T(c.youngerThan,r)||x(c.minAdded)&&r.added<c.minAdded||x(c.maxAdded)&&r.added>c.maxAdded?!0:(r.reasons.splice(a,1),r.reasons.length===0?(s(l,r),n.push(r),!1):!0)});let o=n.map(l=>l.added),d=l=>!o.includes(l[1].added);this.added=this.added.filter(d);for(let l of n)v(l,r=>{this.indexes[r].entries=this.indexes[r].entries.filter(d),this.indexes[r].added=this.indexes[r].added.filter(d)})}}async clean(){this.entries=[],this.added=[],this.indexes={},this.lastReceived=0,this.lastAdded=0,this.lastSent=0}async getLastAdded(){return this.lastAdded}async getLastSynced(){return{received:this.lastReceived,sent:this.lastSent}}async setLastSynced(e){typeof e.sent<"u"&&(this.lastSent=e.sent),typeof e.received<"u"&&(this.lastReceived=e.received)}}class D extends Error{static describe(e,t){return e==="timeout"?"A timeout was reached ("+t+" ms)":e==="wrong-format"?"Wrong message format in "+t:e==="unknown-message"?"Unknown message `"+t+"` type":e==="bruteforce"?"Too many wrong authentication attempts":e==="wrong-protocol"?`Logux supports protocols only from version ${t.supported}, but you use ${t.used}`:e==="wrong-subprotocol"?`Only ${t.supported} application subprotocols are supported, but you use ${t.used}`:e==="wrong-credentials"?"Wrong credentials":e}constructor(e,t,s){super(e),this.name="LoguxError",this.type=e,this.options=t,this.description=D.describe(e,t),this.received=!!s,s?(this.message="Logux received "+this.type+" error",this.description!==this.type&&(this.message+=" ("+this.description+")")):this.message=this.description,Error.captureStackTrace&&Error.captureStackTrace(this,D)}}async function ee(i,e,t,s){if(!i.options.auth){i.authenticated=!0,s();return}try{if(await i.options.auth(e,t,i.remoteHeaders)){i.authenticated=!0,s();for(let o=0;o<i.unauthenticated.length;o++)i.onMessage(i.unauthenticated[o]);i.unauthenticated=[]}else i.sendError(new D("wrong-credentials")),i.destroy()}catch(n){n.name==="LoguxError"?(i.sendError(n),i.destroy()):i.error(n)}}function te(i,e){return i.remoteProtocol=e,e>=i.minProtocol?!0:(i.sendError(new D("wrong-protocol",{supported:i.minProtocol,used:e})),i.destroy(),!1)}function ie(i){try{i.emitter.emit("connect")}catch(e){if(e.name==="LoguxError")return i.sendError(e),!1;throw e}return!0}async function ue(){let i=["connect",this.localProtocol,this.localNodeId,this.lastReceived],e={};this.options.token&&(typeof this.options.token=="function"?e.token=await this.options.token():e.token=this.options.token),this.options.subprotocol&&(e.subprotocol=this.options.subprotocol),Object.keys(e).length>0&&i.push(e),this.options.fixTime&&(this.connectSended=this.now()),Object.keys(this.localHeaders).length>0&&this.sendHeaders(this.localHeaders),this.startTimeout(),this.send(i)}async function ge(i,e){let t=["connected",this.localProtocol,this.localNodeId,[i,e]],s={};this.options.token&&(typeof this.options.token=="function"?s.token=await this.options.token():s.token=this.options.token),this.options.subprotocol&&(s.subprotocol=this.options.subprotocol),Object.keys(s).length>0&&t.push(s),Object.keys(this.localHeaders).length>0&&this.sendHeaders(this.localHeaders),this.send(t)}function fe(i,e,t,s){let n=this.now();if(s||(s={}),this.remoteNodeId=e,!!te(this,i)){if(this.remoteSubprotocol=s.subprotocol||"0.0.0",!ie(this)){this.destroy();return}ee(this,e,s.token,()=>{this.baseTime=this.now(),this.sendConnected(n,this.baseTime),this.syncSince(t)})}}function pe(i,e,t,s){if(s||(s={}),this.endTimeout(),this.remoteNodeId=e,!!te(this,i)){if(this.baseTime=t[1],this.options.fixTime){let n=this.now(),o=t[1]-t[0],d=n-this.connectSended-o;this.timeFix=Math.floor(this.connectSended-t[0]+d/2)}if(this.remoteSubprotocol=s.subprotocol||"0.0.0",!ie(this)){this.destroy();return}ee(this,e,s.token,()=>{this.syncSince(this.lastSent)})}}function me(i,e){this.startTimeout();let t=[];for(let[s,n]of e){let o={};for(let d in n)d==="id"?o.id=n.id.split(" "):d!=="added"&&(o[d]=n[d]);this.timeFix&&(o.time-=this.timeFix),o.id[0]=parseInt(o.id[0])-this.baseTime,o.id[2]=parseInt(o.id[2]),o.time-=this.baseTime,o.id[1]===this.localNodeId&&(o.id[2]===0?o.id=o.id[0]:o.id=[o.id[0],o.id[2]]),t.unshift(s,o)}this.syncing+=1,this.setState("sending"),this.send(["sync",i].concat(t))}function ye(i){this.send(["synced",i])}async function be(i,...e){for(let t=0;t<e.length-1;t+=2){let s=e[t],n=e[t+1];typeof n.id=="number"?n.id=n.id+this.baseTime+" "+this.remoteNodeId+" "+0:(n.id[0]=n.id[0]+this.baseTime,n.id.length===2?n.id=n.id[0]+" "+this.remoteNodeId+" "+n.id[1]:n.id=n.id.join(" ")),n.time=n.time+this.baseTime,this.timeFix&&(n.time=n.time+this.timeFix);let o=Promise.resolve([s,n]);this.options.inMap&&(o=o.then(([d,l])=>this.options.inMap(d,l)).catch(d=>{this.error(d)})),await o.then(d=>d&&this.options.inFilter?this.options.inFilter(...d).then(l=>l?d:!1).catch(l=>{this.error(l)}):d).then(d=>d?(this.received&&(this.received[d[1].id]=!0),this.log.add(d[0],d[1])):!1)}this.setLastReceived(i),this.sendSynced(i)}function Ie(i){this.endTimeout(),this.setLastSent(i),this.syncing>0&&(this.syncing-=1),this.syncing===0&&this.setState("synchronized")}function we(){this.startTimeout(),this.send(["ping",this.lastAddedCache]),this.pingTimeout&&clearTimeout(this.pingTimeout)}function De(i){this.setLastReceived(i),this.connected&&this.authenticated&&this.send(["pong",this.lastAddedCache])}function Ce(i){this.setLastReceived(i),this.endTimeout()}function Se(i){this.send(["headers",i])}function ve(i){this.remoteHeaders=i,this.emitter.emit("headers",i)}function Te(i,e){this.send(["debug",i,e])}function Ee(i,e){this.emitter.emit("debug",i,e)}function xe(i){let e=["error",i.type];typeof i.options<"u"&&e.push(i.options),this.send(e),this.emitter.emit("clientError",i)}function ke(i,e){this.syncError(i,e,!0)}const Le={"wrong-subprotocol":!0,"wrong-protocol":!0,timeout:!0},He=["connect","connected","error","debug","headers"];async function F(i,e,t){let s=t.added;if(typeof s>"u"){let n=i.lastAddedCache;s=n>i.lastSent?n:i.lastSent}if(i.options.outMap)try{let n=await i.options.outMap(e,t);i.sendSync(s,[n])}catch(n){i.error(n)}else i.sendSync(s,[[e,t]])}class p{constructor(e,t,s,n={}){if(this.remoteNodeId=void 0,this.remoteProtocol=void 0,this.remoteSubprotocol=void 0,this.minProtocol=3,this.localProtocol=4,this.localNodeId=e,this.log=t,this.connection=s,this.options=n,this.options.ping&&!this.options.timeout)throw new Error("You must set timeout option to use ping");this.connected=!1,this.authenticated=!1,this.unauthenticated=[],this.timeFix=0,this.syncing=0,this.received={},this.lastSent=0,this.lastReceived=0,this.state="disconnected",this.emitter=L(),this.timeouts=[],this.throwsError=!0,this.unbind=[t.on("add",(o,d)=>{this.onAdd(o,d)}),s.on("connecting",()=>{this.onConnecting()}),s.on("connect",()=>{this.onConnect()}),s.on("message",o=>{this.onMessage(o)}),s.on("error",o=>{o.message==="Wrong message format"?(this.sendError(new D("wrong-format",o.received)),this.connection.disconnect("error")):this.error(o)}),s.on("disconnect",()=>{this.onDisconnect()})],this.initialized=!1,this.lastAddedCache=0,this.initializing=this.initialize(),this.localHeaders={},this.remoteHeaders={}}on(e,t){return this.emitter.on(e,t)}catch(e){this.throwsError=!1;let t=this.on("error",e);return()=>{this.throwsError=!0,t()}}waitFor(e){return this.state===e?Promise.resolve():new Promise(t=>{let s=this.on("state",()=>{this.state===e&&(s(),t())})})}destroy(){this.connection.destroy?this.connection.destroy():this.connected&&this.connection.disconnect("destroy");for(let e of this.unbind)e();clearTimeout(this.pingTimeout),this.endTimeout()}setLocalHeaders(e){this.localHeaders=e,this.connected&&this.sendHeaders(e)}send(e){if(!!this.connected){this.delayPing();try{this.connection.send(e)}catch(t){this.error(t)}}}onConnecting(){this.setState("connecting")}onConnect(){this.delayPing(),this.connected=!0}onDisconnect(){for(;this.timeouts.length>0;)this.endTimeout();this.pingTimeout&&clearTimeout(this.pingTimeout),this.authenticated=!1,this.connected=!1,this.syncing=0,this.setState("disconnected")}onMessage(e){this.delayPing();let t=e[0];if(!this.authenticated&&!He.includes(t)){this.unauthenticated.push(e);return}this[t+"Message"](...e.slice(1))}async onAdd(e,t){if(!!this.authenticated){if(this.lastAddedCache<t.added&&(this.lastAddedCache=t.added),this.received&&this.received[t.id]){delete this.received[t.id];return}if(this.options.outFilter)try{await this.options.outFilter(e,t)&&F(this,e,t)}catch(s){this.error(s)}else F(this,e,t)}}syncError(e,t,s){let n=new D(e,t,s);if(this.emitter.emit("error",n),!Le[e]&&this.throwsError)throw n}error(e){if(this.emitter.emit("error",e),this.connection.disconnect("error"),this.throwsError)throw e}setState(e){this.state!==e&&(this.state=e,this.emitter.emit("state"))}startTimeout(){if(!this.options.timeout)return;let e=this.options.timeout,t=setTimeout(()=>{this.connected&&this.connection.disconnect("timeout"),this.syncError("timeout",e)},e);this.timeouts.push(t)}endTimeout(){this.timeouts.length>0&&clearTimeout(this.timeouts.shift())}delayPing(){!this.options.ping||(this.pingTimeout&&clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{this.connected&&this.authenticated&&this.sendPing()},this.options.ping))}async syncSinceQuery(e){let t=[];await this.log.each({order:"added"},(o,d)=>d.added<=e?!1:(this.options.outFilter?t.push(this.options.outFilter(o,d).then(l=>l?[o,d]:!1).catch(l=>{this.error(l)})):t.push(Promise.resolve([o,d])),!0));let s=await Promise.all(t),n={added:0};return n.entries=s.filter(o=>(o&&n.added<o[1].added&&(n.added=o[1].added),o!==!1)),n}async syncSince(e){let t=await this.syncSinceQuery(e);!this.connected||(t.entries.length>0?this.options.outMap?Promise.all(t.entries.map(s=>this.options.outMap(s[0],s[1]))).then(s=>{this.sendSync(t.added,s)}).catch(s=>{this.error(s)}):this.sendSync(t.added,t.entries):this.setState("synchronized"))}setLastSent(e){this.lastSent<e&&(this.lastSent=e,this.log.store.setLastSynced({sent:e}))}setLastReceived(e){this.lastReceived<e&&(this.lastReceived=e),this.log.store.setLastSynced({received:e})}now(){return Date.now()}async initialize(){let[e,t]=await Promise.all([this.log.store.getLastSynced(),this.log.store.getLastAdded()]);this.initialized=!0,this.lastSent=e.sent,this.lastReceived=e.received,this.lastAddedCache=t,this.connection.connected&&this.onConnect()}sendDuilian(){this.send(["duilian",Object.keys(N)[0]])}duilianMessage(e){N[e]&&this.send(["duilian",N[e]])}}p.prototype.sendConnect=ue;p.prototype.sendConnected=ge;p.prototype.connectMessage=fe;p.prototype.connectedMessage=pe;p.prototype.sendSync=me;p.prototype.sendSynced=ye;p.prototype.syncMessage=be;p.prototype.syncedMessage=Ie;p.prototype.sendPing=we;p.prototype.pingMessage=De;p.prototype.pongMessage=Ce;p.prototype.sendDebug=Te;p.prototype.debugMessage=Ee;p.prototype.sendError=xe;p.prototype.errorMessage=ke;p.prototype.sendHeaders=Se;p.prototype.headersMessage=ve;const N={\u91D1\u6728\u6C34\u706B\u571F:"\u677F\u57CE\u70E7\u9505\u9152"},Pe={fixTime:!0,timeout:7e4,ping:1e4};class se extends p{constructor(e,t,s,n={}){n={...Pe,...n},super(e,t,s,n)}onConnect(){this.connected||(this.connected=!0,this.initializing=this.initializing.then(()=>{this.connected&&this.sendConnect()}))}}class Y{constructor(e,t){this.connected=!1,this.emitter=L(),this.type=t,this.pair=e}other(){return this.type==="left"?this.pair.right:this.pair.left}on(e,t){return this.emitter.on(e,t)}connect(){if(this.connected)throw new Error("Connection already established");return this.emitter.emit("connecting"),new Promise(e=>{setTimeout(()=>{this.other().connected=!0,this.connected=!0,this.other().emitter.emit("connect"),this.emitter.emit("connect"),e()},this.pair.delay)})}disconnect(e){if(this.connected)return this.connected=!1,this.emitter.emit("disconnect",e),new Promise(t=>{setTimeout(()=>{this.other().connected=!1,this.other().emitter.emit("disconnect"),t()},1)});throw new Error("Connection already finished")}send(e){if(this.connected)setTimeout(()=>{this.other().emitter.emit("message",e)},this.pair.delay);else throw new Error("Connection should be started before sending a message")}}class qe{constructor(e=1){this.delay=e,this.left=new Y(this,"left"),this.right=new Y(this,"right")}}const Oe={minDelay:1e3,maxDelay:5e3,attempts:1/0},Ne=["wrong-protocol","wrong-subprotocol","wrong-credentials"];class Ke{constructor(e,t={}){this.connection=e,this.options={...Oe,...t},this.reconnecting=e.connected,this.connecting=!1,this.attempts=0,this.unbind=[this.connection.on("message",d=>{d[0]==="error"&&Ne.includes(d[1])&&(this.reconnecting=!1)}),this.connection.on("connecting",()=>{this.connecting=!0}),this.connection.on("connect",()=>{this.attempts=0,this.connecting=!1}),this.connection.on("disconnect",()=>{this.connecting=!1,this.reconnecting&&this.reconnect()}),()=>{clearTimeout(this.timer)}];let s=()=>{this.reconnecting&&!this.connected&&!this.connecting&&typeof document<"u"&&!document.hidden&&this.connect()},n=()=>{this.reconnecting&&!this.connected&&!this.connecting&&navigator.onLine&&this.connect()},o=()=>{this.disconnect("freeze")};typeof document<"u"&&typeof window<"u"&&document.addEventListener&&window.addEventListener&&(document.addEventListener("visibilitychange",s,!1),window.addEventListener("focus",n,!1),window.addEventListener("online",n,!1),window.addEventListener("resume",n,!1),window.addEventListener("freeze",o,!1),this.unbind.push(()=>{document.removeEventListener("visibilitychange",s,!1),window.removeEventListener("focus",n,!1),window.removeEventListener("online",n,!1),window.removeEventListener("resume",n,!1),window.removeEventListener("freeze",o,!1)}))}connect(){return this.attempts+=1,this.reconnecting=!0,this.connection.connect()}disconnect(e){return e!=="timeout"&&e!=="error"&&e!=="freeze"&&(this.reconnecting=!1),this.connection.disconnect(e)}destroy(){for(let e of this.unbind)e();this.disconnect("destroy")}reconnect(){if(this.attempts>this.options.attempts-1){this.reconnecting=!1,this.attempts=0;return}let e=this.nextDelay();this.timer=setTimeout(()=>{this.reconnecting&&!this.connecting&&!this.connected&&this.connect()},e)}send(...e){return this.connection.send(...e)}on(...e){return this.connection.on(...e)}nextDelay(){let e=this.options.minDelay*2**this.attempts,t=Math.random(),s=t*.5*e;return Math.floor(t*10)===1&&(s=-s),Math.min(e+s,this.options.maxDelay)||0}get connected(){return this.connection.connected}get emitter(){return this.connection.emitter}}function G(i){i.includes(" ")&&(i=i.split(" ")[1]);let e=i.split(":");if(e.length===1)return{nodeId:i,userId:void 0,clientId:i};{let t=e[0];return{nodeId:i,userId:t,clientId:e[0]+":"+e[1]}}}class Re extends Error{constructor(e){let t=e.action?e.action.type:"action";super(`Server undid ${t} because of ${e.reason}`),this.name="LoguxUndoError",this.action=e}}function Ge(i,e){if(i.processing[e])return i.processing[e][0];let t,s,n=new Promise((o,d)=>{t=o,s=d});return i.processing[e]=[n,t,s],n}function ne(i,e,t={}){let s=i.on?i:i.node,n=s.state==="disconnected",o=!1,d=!1;typeof t.duration>"u"&&(t.duration=3e3);let l,r=[],c={};function a(){Object.keys(c).length===0&&(o?(o=!1,e("synchronizedAfterWait"),l=setTimeout(()=>{e("synchronized")},t.duration)):e("synchronized"))}function A(){clearTimeout(l),!d&&(s.state==="disconnected"?(n=!0,e(o?"wait":"disconnected")):s.state==="synchronized"?(n=!1,a()):s.state==="connecting"?l=setTimeout(()=>{e("connecting"+(o?"AfterWait":""))},100):e(i.state+(o?"AfterWait":"")))}r.push(s.on("state",A)),r.push(i.node.on("error",u=>{u.type==="wrong-protocol"||u.type==="wrong-subprotocol"?(d=!0,e("protocolError")):u.type!=="timeout"&&e("syncError",{error:u})})),r.push(i.node.on("clientError",u=>{e("syncError",{error:u})}));let h=i.on?i:i.log;return r.push(h.on("add",(u,f)=>{u.type!=="logux/subscribe"&&u.type!=="logux/unsubscribe"&&(u.type==="logux/processed"?(delete c[u.id],a()):u.type==="logux/undo"?delete c[u.id]:f.sync&&(c[f.id]=!0),u.type==="logux/undo"&&u.reason?u.reason==="denied"?e("denied",{action:u,meta:f}):e("error",{action:u,meta:f}):n&&f.sync&&f.added&&(o||e("wait"),o=!0))})),A(),()=>{for(let u of r)u()}}function P(i,e){for(let t in e)i.style[t]=e[t]}function Ue(i,e){let t=i.style;e==="middle-center"||e==="center-middle"?(t.top="50%",t.left="50%",t.transform="translate(-50%, -50%)"):e.split("-").forEach(s=>{s==="middle"?(t.top="50%",t.transform="translateY(-50%)"):s==="center"?(t.left="50%",t.transform="translateX(-50%)"):t[s]="0"})}const Be={boxSizing:"content-box",visibility:"visible",textIndent:"0",textTransform:"none",wordSpacing:"normal",letterSpacing:"normal",fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",lineHeight:"auto"};function Xe(i,e){let t=e.messages,s=e.position||"bottom-right",n=e.styles,o=document.createElement("div"),d=document.createElement("span");o.setAttribute("role","alert"),P(o,Be),P(o,n.base),P(d,n.text),Ue(o,s);let l=(a,A)=>{d.innerHTML=A,P(o,a),o.style.display="block"},r=()=>{o.style.display="none"},c=ne(i,a=>{a==="sendingAfterWait"||a==="connectingAfterWait"?l(n.sending,t.sending):a==="synchronizedAfterWait"?l(n.synchronized,t.synchronized):a==="synchronized"?r():a==="disconnected"?l(n.disconnected,t.disconnected):a==="wait"?l(n.wait,t.wait):a==="protocolError"?l(n.protocolError,t.protocolError):a==="syncError"?l(n.error,t.syncError):a==="error"?l(n.error,t.error):a==="denied"&&l(n.error,t.denied)},e);return o.appendChild(d),document.body.appendChild(o),()=>{c(),document.body.removeChild(o)}}let Me={synchronized:"Your data has been saved",disconnected:"No Internet connection",wait:"No Internet connection<br>Your data has not been saved",sending:"Data saving",syncError:"Server error<br>Your data has not been saved",error:"Server error<br>You changes was reverted",denied:"You have no access<br>You changes was reverted",protocolError:"Saving is not working<br>Refresh the page"},K=(i=21)=>crypto.getRandomValues(new Uint8Array(i)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),""),Qe=["id","time","subprotocol"];function J(i){localStorage.setItem(i.options.prefix+":tab:"+i.tabId,Date.now())}function j(i,e){i.log.removeReason("tab"+e).then(()=>{i.isLocalStorage&&localStorage.removeItem(i.options.prefix+":tab:"+e)})}function Fe(i,e){return!i&&!e?!0:JSON.stringify(i)===JSON.stringify(e)}function W(i,e){let t=JSON.stringify({...e,type:"logux/subscribe"}),s=i.subscriptions[t];s&&(s===1?delete i.subscriptions[t]:i.subscriptions[t]=s-1)}class Ye{constructor(e={}){if(this.options=e,typeof this.options.prefix>"u"&&(this.options.prefix="logux"),this.isLocalStorage=!1,typeof localStorage<"u"){let A=K();try{localStorage.setItem(A,"1"),localStorage.removeItem(A),this.isLocalStorage=!0}catch{}}this.options.time?(this.tabId=this.options.time.lastId+1+"",this.clientId=this.options.userId+":"+this.tabId):(this.clientId=this.options.userId+":"+this.getClientId(),this.tabId=K(8)),this.nodeId=this.clientId+":"+this.tabId;let t=this.options.store||new _,s;this.options.time?s=this.options.time.nextLog({store:t,nodeId:this.nodeId}):s=new $({store:t,nodeId:this.nodeId}),this.log=s,this.last={},this.subscriptions={};let n={},o={};s.on("preadd",(A,h)=>{if(G(h.id).nodeId===this.nodeId&&!h.subprotocol&&(h.subprotocol=this.options.subprotocol),A.type==="logux/unsubscribe"){let u=!0,f=!1;for(let w in n){let S=n[w];if(S.channel===A.channel&&Fe(A.filer,S.filter)){u=!1,delete n[w],s.changeMeta(w,{reasons:[]});break}}u&&this.state==="disconnected"&&(f=!0,W(this,A)),u&&!f?h.sync=!0:delete h.sync}h.sync&&!h.resubscribe&&h.reasons.push("syncing")}),this.emitter=L(),this.on("add",(A,h)=>{let u=A.type,f;if((u==="logux/processed"||u==="logux/undo")&&this.log.removeReason("syncing",{id:A.id}),u==="logux/subscribe"&&!h.resubscribe)n[h.id]=A;else if(u==="logux/unsubscribe")h.sync&&(o[h.id]=A);else if(u==="logux/processed"){if(o[A.id])W(this,o[A.id]);else if(n[A.id]){let w=n[A.id];delete n[A.id];let S=JSON.stringify(w);this.subscriptions[S]?this.subscriptions[S]+=1:this.subscriptions[S]=1,f=this.last[w.channel],(!f||T(f,h))&&(this.last[w.channel]={id:h.id,time:h.time})}this.processing[A.id]&&(this.processing[A.id][1](h),delete this.processing[A.id])}else u==="logux/undo"?(this.processing[A.id]&&(this.processing[A.id][2](new Re(A)),delete this.processing[A.id]),delete n[A.id],delete o[A.id]):h.channels&&(h.id.includes(" "+this.clientId+":")||h.channels.forEach(w=>{f=this.last[w],(!f||T(f,h))&&(this.last[w]={id:h.id,time:h.time})}))}),this.tabPing=6e4,this.tabTimeout=10*this.tabPing;let d="tab"+this.tabId;if(this.isLocalStorage){let A=s.on("add",(h,u)=>{u.reasons.includes(d)&&(J(this),this.pinging=setInterval(()=>{J(this)},this.tabPing),A())})}let l;if(typeof this.options.server=="string"){let A=new he(this.options.server);l=new Ke(A,{minDelay:this.options.minDelay,maxDelay:this.options.maxDelay,attempts:this.options.attempts})}else l=this.options.server;let r=async(A,h)=>!!h.sync&&G(h.id).userId===this.options.userId,c=async(A,h)=>{let u={};for(let f in h)f==="subprotocol"?h.subprotocol!==this.options.subprotocol&&(u.subprotocol=h.subprotocol):Qe.includes(f)&&(u[f]=h[f]);return[A,u]};if(this.options.time||(typeof this.options.timeout>"u"&&(this.options.timeout=2e4),typeof this.options.ping>"u"&&(this.options.ping=5e3)),this.node=new se(this.nodeId,this.log,l,{subprotocol:this.options.subprotocol,outFilter:r,timeout:this.options.timeout,fixTime:!this.options.time,outMap:c,token:this.options.token,ping:this.options.ping}),/^ws:\/\//.test(this.options.server)&&!e.allowDangerousProtocol){let A=this.node.on("state",()=>{this.node.state==="synchronized"&&(A(),this.node.remoteHeaders.env!=="development"&&(console.error("Without SSL, old proxies block WebSockets. Use WSS for Logux or set allowDangerousProtocol option."),this.destroy()))})}this.node.on("debug",(A,h)=>{A==="error"&&console.error(`Error on Logux server:
`,h)});let a=!0;this.node.on("state",()=>{if(this.node.state==="synchronized"){if(a){a=!1;for(let h in this.subscriptions){let u=JSON.parse(h),f=this.last[u.channel];f&&(u.since=f),this.log.add(u,{sync:!0,resubscribe:!0})}}}else this.node.state==="disconnected"&&(a=!0)}),this.onUnload=this.onUnload.bind(this),typeof window<"u"&&window.addEventListener&&window.addEventListener("unload",this.onUnload),this.processing={}}get state(){return this.node.state}get connected(){return this.state!=="disconnected"&&this.state!=="connecting"}start(){this.cleanPrevActions(),this.node.connection.connect()}sync(e,t={}){return t.sync=!0,typeof t.id>"u"&&(t.id=this.log.generateId()),this.log.add(e,t),Ge(this,t.id)}type(e,t,s){return typeof e=="function"&&(e=e.type),this.log.type(e,t,s)}on(e,t){return e==="state"?this.node.emitter.on(e,t):e==="user"?this.emitter.on(e,t):this.log.emitter.on(e,t)}changeUser(e,t){let s=this.node.connected;s&&this.node.connection.disconnect("destroy"),this.options.userId=e,this.options.token=t,this.clientId=e+":"+this.getClientId(),this.nodeId=this.clientId+":"+this.tabId,this.log.nodeId=this.nodeId,this.node.localNodeId=this.nodeId,this.node.options.token=t,this.emitter.emit("user",e),s&&this.node.connection.connect()}waitFor(e){return this.state===e?Promise.resolve():new Promise(t=>{let s=this.on("state",()=>{this.state===e&&(s(),t())})})}destroy(){this.onUnload(),this.node.destroy(),clearInterval(this.pinging),typeof window<"u"&&window.removeEventListener&&window.removeEventListener("unload",this.onUnload)}clean(){return this.destroy(),this.log.store.clean?this.log.store.clean():Promise.resolve()}cleanPrevActions(){if(!!this.isLocalStorage)for(let e in localStorage){let t=this.options.prefix+":tab:";if(e.slice(0,t.length)===t){let s=parseInt(localStorage.getItem(e));Date.now()-s>this.tabTimeout&&j(this,e.slice(t.length))}}}onUnload(){this.pinging&&j(this,this.tabId)}getClientId(){return K(8)}}function m(i,e){return i.options.prefix+":"+i.options.userId+":"+e}function C(i,e,t){if(!i.isLocalStorage)return;let s=m(i,e),n=JSON.stringify(t);try{localStorage.setItem(s,n)}catch(o){console.error(o),i.isLocalStorage=!1,i.role="leader",i.emitter.emit("role"),i.node.connection.connect()}}function oe(i){let e=localStorage.getItem(m(i,"leader")),t=[];return typeof e=="string"&&(t=JSON.parse(e)),t}function re(i){C(i,"leader",[i.tabId,Date.now()])}function de(i){i.state!=="disconnected"&&ce(i,"disconnected"),Ae(i)}function q(i){clearTimeout(i.watching),i.watching=setTimeout(()=>{le(i)?q(i):de(i)},i.roleTimeout)}function Je(i,e){let t=i.split("."),s=e.split(".");for(let n=0;n<3;n++){let o=parseInt(t[n]||0),d=parseInt(s[n]||0);if(o>d)return 1;if(o<d)return-1}return 0}function k(i,e){if(i.role!==e){let t=i.node;if(i.role=e,clearTimeout(i.watching),e==="leader"?(localStorage.removeItem(m(i,"state")),i.leadership=setInterval(()=>{i.unloading||re(i)},i.leaderPing),t.connection.connect()):(clearTimeout(i.elections),clearInterval(i.leadership),t.state!=="disconnected"&&i.node.connection.disconnect()),e==="follower"){let s="disconnected",n=localStorage.getItem(m(i,"state"));n&&n!==null&&(s=JSON.parse(n)),s!==i.state&&(i.state=s,i.emitter.emit("state"))}i.emitter.emit("role")}}function le(i){let e=oe(i);return e[1]&&e[1]>=Date.now()-i.leaderTimeout}function Ae(i){re(i),k(i,"candidate"),i.elections=setTimeout(()=>{oe(i)[0]===i.tabId?k(i,"leader"):(k(i,"follower"),q(i))},i.electionDelay)}function ce(i,e){i.state=e,i.emitter.emit("state"),C(i,"state",i.state)}function je(i){return Array.isArray(i.entries)&&Array.isArray(i.added)}class We extends Ye{constructor(e={}){if(super(e),this.role="candidate",this.roleTimeout=3e3+Math.floor(Math.random()*1e3),this.leaderTimeout=5e3,this.leaderPing=2e3,this.electionDelay=1e3,this.leaderState=this.node.state,this.node.on("state",()=>{this.role==="leader"&&ce(this,this.node.state)}),this.log.on("add",(t,s)=>{I(this.emitter,"add",t,s),s.tab!==this.tabId&&C(this,"add",[this.tabId,t,s])}),this.log.on("clean",(t,s)=>{I(this.emitter,"clean",t,s)}),typeof window<"u"&&window.addEventListener&&(window.addEventListener("storage",t=>this.onStorage(t)),window.addEventListener("unload",t=>this.onUnload(t))),this.isLocalStorage){let t=m(this,"subprotocol");localStorage.getItem(t)!==this.options.subprotocol&&C(this,"subprotocol",this.options.subprotocol)}}get state(){return this.leaderState}set state(e){this.leaderState=e}start(){if(this.cleanPrevActions(),!this.isLocalStorage){this.role="leader",this.emitter.emit("role"),this.node.connection.connect();return}le(this)?(k(this,"follower"),q(this)):Ae(this)}destroy(){super.destroy(),clearTimeout(this.watching),clearTimeout(this.elections),clearInterval(this.leadership),typeof window<"u"&&window.removeEventListener&&window.removeEventListener("storage",this.onStorage)}clean(){return this.isLocalStorage&&(localStorage.removeItem(m(this,"add")),localStorage.removeItem(m(this,"state")),localStorage.removeItem(m(this,"client")),localStorage.removeItem(m(this,"leader"))),super.clean()}changeUser(e,t){C(this,"user",[this.tabId,e]),super.changeUser(e,t)}type(e,t,s={}){if(s.event==="preadd")return this.log.type(e,t,s);{let n=s.event||"add",o=s.id||"";return this.emitter.on(`${n}-${e}-${o}`,t)}}on(e,t){return e==="preadd"?this.log.emitter.on(e,t):this.emitter.on(e,t)}onStorage(e){if(e.newValue===null)return;let t;if(e.key===m(this,"add")){if(t=JSON.parse(e.newValue),t[0]!==this.tabId){let s=t[1],n=t[2];(!n.tab||n.tab===this.tabId)&&(je(this.log.store)&&this.log.store.add(s,n),I(this.emitter,"add",s,n),this.role==="leader"&&this.node.onAdd(s,n))}}else if(e.key===m(this,"leader"))t=JSON.parse(e.newValue),t.length===0?de(this):t[0]!==this.tabId&&this.role!=="candidate"&&(k(this,"follower"),q(this));else if(e.key===m(this,"state")){let s=JSON.parse(localStorage.getItem(e.key));this.leaderState!==s&&(this.leaderState=s,this.emitter.emit("state"))}else if(e.key===m(this,"user"))t=JSON.parse(e.newValue),t[0]!==this.tabId&&this.emitter.emit("user",t[1]);else if(e.key===m(this,"subprotocol")){let s=JSON.parse(e.newValue),n=Je(this.options.subprotocol,s);if(n===1)C(this,"subprotocol",this.options.subprotocol);else if(n===-1){let o=new D("wrong-subprotocol",{supported:s,used:this.options.subprotocol},!0);this.node.emitter.emit("error",o)}}}onUnload(){this.role==="leader"&&(this.unloading=!0,C(this,"leader",[])),super.onUnload()}getClientId(){let e=m(this,"client");if(this.isLocalStorage){if(localStorage.getItem(e))return localStorage.getItem(e);{let t=super.getClientId();return localStorage.setItem(e,t),t}}else return super.getClientId()}}function Ve(i){let e=document,t=!1,s=[],n=!1,o=()=>{t&&(e.title=t,t=!1)},d=()=>{e.hidden&&!t?(t=e.title,e.title="* "+e.title):o(),e.hidden&&(n=setTimeout(d,1e3))},l=()=>{!e.hidden&&n&&(n=clearTimeout(n),o())};return e&&typeof e.hidden<"u"&&(s.push(i.node.on("error",r=>{r.type!=="timeout"&&!n&&d()})),s.push(i.on("add",r=>{r.type==="logux/undo"&&r.reason&&!n&&d()})),document.addEventListener("visibilitychange",l,!1),s.push(()=>{document.removeEventListener("visibilitychange",l,!1)})),()=>{for(let r of s)r()}}function V(i){return i.returnValue="unsynced","unsynced"}function ze(i){let e=i.state==="disconnected",t=!1,s=()=>{i.state==="disconnected"?e=!0:i.state==="synchronized"&&(e=!1,t=!1),typeof window<"u"&&window.addEventListener&&(i.role!=="follower"&&t&&e?window.addEventListener("beforeunload",V):window.removeEventListener("beforeunload",V))},n=[];return n.push(i.on("role",s)),n.push(i.on("state",s)),s(),n.push(i.on("add",(o,d)=>{o.type!=="logux/subscribe"&&o.type!=="logux/unsubscribe"&&e&&d.sync&&d.added&&(t=!0,s())})),()=>{for(let o of n)o()}}function Ze(i,e){let t=e.normal,s=e.offline,n=e.error,o=[],d=document,l=!1,r=!1;function c(){i.connected&&r!==t?l.href=r=t:!i.connected&&s&&r!==s&&r!==n&&(l.href=r=s)}function a(){n&&r!==n&&(l.href=r=n)}return d&&(l=d.querySelector('link[rel~="icon"]'),typeof t>"u"&&(t=l?l.href:""),l||(l=d.createElement("link"),l.rel="icon",l.href="",d.head.appendChild(l)),o.push(i.on("state",c)),c(),o.push(i.on("add",A=>{A.type==="logux/undo"&&A.reason&&a()})),o.push(i.node.on("error",A=>{A.type!=="timeout"&&a()}))),()=>{for(let A of o)A()}}function y(i){return"%c"+i+"%c"}const ae="#c00000";function b(i,e,t){i="%cLogux%c "+i;let s=Array.from(i.match(/%c/g)).map((n,o)=>o===0?t===ae?`color:${t};font-weight:bold`:"color:#ffa200;font-weight:bold":o%2===0?t?`font-weight:bold;color:${t}`:"font-weight:bold":"font-weight:normal");if(e){console.groupCollapsed(i,...s);for(let n in e)typeof e[n]=="string"?console.log(n+": %c"+e[n],"font-weight:bold"):console.log(n,e[n]);console.groupEnd()}else console.log(i,...s)}function $e(i,e={}){let t=i.node,s={},n=[],o=!1;e.state!==!1&&n.push(i.on("state",()=>{let r;i.state==="connecting"&&t.connection.url?r={"Node ID":t.localNodeId,Server:t.connection.url}:i.connected&&!o&&t.remoteNodeId?(o=!0,r={"Server ID":t.remoteNodeId}):i.connected||(o=!1),b("state is "+y(i.state),r)})),e.role!==!1&&n.push(i.on("role",()=>{b("tab role is "+y(i.role))}));let d={},l=(e.ignoreActions||[]).reduce((r,c)=>(r[c]=!0,r),{});return e.add!==!1&&n.push(i.on("add",(r,c)=>{if(c.tab&&c.tab!==i.tabId||l[r.type])return;c.sync&&(s[c.id]=r);let a;if(r.type==="logux/subscribe")a="subscribing to "+y(r.channel)+" channel",Object.keys(r).length===2?b(a):b(a,{Action:r});else if(r.type==="logux/subscribed")b("subscribed to "+y(r.channel)+" channel by server");else if(r.type==="logux/unsubscribe")a="unsubscribed from channel "+y(r.channel),Object.keys(r).length===2?b(a):b(a,{Action:r});else if(r.type==="logux/processed")if(s[r.id]){let A=s[r.id],h={"Processed Action":A};A.type==="logux/subscribe"?b("subscribed to "+y(A.channel)+" channel",h):b("action "+y(A.type)+" was processed",h),delete s[r.id]}else b("action "+y(r.id)+" was processed");else if(r.type==="logux/undo"){r.action.type==="logux/subscribe"?a="subscription to "+y(r.action.channel):a="action "+y(r.action.type),a+=" was undone because of "+y(r.reason);let A={"Reverted Action":r.action};Object.keys(r).length>4&&(A["Undo Action"]=r),s[r.id]&&delete s[r.id],b(a,A,ae)}else{let A={Action:r,Meta:c};a="added ",c.reasons.length===0&&(d[c.id]=!0,a+="and cleaned "),a+=y(r.type)+" action";let{nodeId:h}=G(c.id);h!==t.localNodeId&&(A.From=h),b(a,A,"#008000")}})),e.user!==!1&&n.push(i.on("user",r=>{let c="user ID was changed to "+y(r);b(c,{"Node ID":i.nodeId})})),e.clean!==!1&&n.push(i.on("clean",(r,c)=>{if(d[c.id]){delete d[c.id];return}if(c.tab&&c.tab!==i.tabId||l[r.type]||r.type.startsWith("logux/"))return;let a="cleaned "+y(r.type)+" action";b(a,{Action:r,Meta:c})})),()=>{for(let r of n)r()}}const z="/client/assets/refresh.9f4c25a3.svg",_e="/client/assets/success.22d27a29.svg",Z="/client/assets/offline.e32df626.svg",et="/client/assets/error.78666971.svg";let tt={base:{position:"fixed",width:"15.4em",height:"4em",lineHeight:"1.4",margin:"1.5em",paddingLeft:"4.2em",opacity:"0.8",borderRadius:"0.4em",color:"#fff",fontFamily:"Helvetica Neue, sans-serif",zIndex:"999",backgroundPosition:"1.2em center",backgroundRepeat:"no-repeat",backgroundSize:"1.8em"},text:{display:"table-cell",verticalAlign:"middle",height:"4em"},synchronized:{backgroundColor:"#000",backgroundImage:"url("+_e+")"},disconnected:{backgroundColor:"#000",backgroundImage:"url("+Z+")"},wait:{backgroundColor:"#000",backgroundImage:"url("+Z+")"},sending:{backgroundColor:"#000",backgroundImage:"url("+z+")"},error:{backgroundColor:"#F42A2A",backgroundImage:"url("+et+")"},protocolError:{backgroundColor:"#000",backgroundImage:"url("+z+")"}};const it="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4CAMAAAAOusbgAAABzlBMVEUAAAAAAACAgICZmZmAgICSkpKLi4uAgICJiYmAgICIiIiHh4eAgICGhoaAgICGhoaAgICFhYWAgICFhYWAgICEhISAgICEhISAgICEhISAgICDg4OAgICDg4OAgICDg4OAgICDg4OAgICDg4OAgICCgoKAgICAgICCgoKAgICCgoKAgICAgICCgoKAgICCgoKAgICCgoKAgICBgYGBgYGAgICBgYGAgICBgYGBgYGAgICAgICBgYGAgICBgYGAgICBgYGAgICAgICBgYGAgICBgYGBgYGAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICq+RHaAAAAmXRSTlMAAQQFBgcLDA0ODxESExQVFhcYGRobHB0eHyAhIiMkJSYnKCksLS4wMTI3ODo7PD0+P0xNT1BTVFVXWFpbXl9gYWJmaWprbW6AgYKDhYaHiImKi4yNjo+RkpSXmZqbnJ2foqqtrq+5u7y+xMXGx8jJysvQ0dLT1dbY2drc3d7g4eLj5OXm5+jq6+zt7u/w8fX29/j5+vv8/f5OSOWKAAACyklEQVR4Ae3aA7okSxQE4Bjbtm3bc23btm2b1f1ex25nA1nO813Vv4BCGoGdIBAIBI49/ZVS1dQ5uGAYC4OdTZUpv54eg7TTHwuGqDBZ/vsSxNxJ7qeFvsTbEHA8po22WqKPQ6+LOSt0ZL3gAvS5krNGx0Jlt6DH/pQwXQnnHIIGb8bo2uS3XfDpSh09qb0EX94u0KOlj/BuT0qEnkVy9sKjM230pfkUPLnST5+GbsCDexP0bfohXHu1TA2WX8Cl+4vUYvkRXLk2RU1mbsKFk/3UZvA0HNvXRo2a98KpXGqVCYdeR6hV5B0cuThPzRauwIFdddSuBg58pYBPsHVoggKmDsu3aLUs2LjxH0WEr8FaCYUUwtIFg0JCl2Alj2JyYOHEKsWsHoO5GAqKgrk2CmqGqTsUdQtmkikqHmb6KaoHJs5R2DmofaOwr1ArpbBiqI1Q2BCUjlPcUag8o7gnUPlFcd+hkkpxSVCporgKqDRRXD1UuiiuAyrDFDcElXmKm4WKQXHrG//ijS/qjWxcG9adNmwA2bAhM4XiEqHyk+K+QeUpxT2GylGKO4qN6chDG7W8LdqoBf0XqJ2lrMgZmOilqG6YSaKoOJi5uVEbc7RSUCPMRVPQH5g7vkoxK8dgIZdismHlvEEh6+dgqYhC8mHtWpgiQldgI5si0mHn4DgFTB6Crc8U8AEO1FK7ajhxYY6aLVzeoCu+t1CRb9lpcGpvMzVq2APHTvRSm4FTcOHqJDWZvAJX7ukKJzyESy+XqMHSc7h2d5y+TT2AB1f66NPgdXhyqpm+NJyAR7tj/5ePVam9madHS+/hy6UaelJ9AX69GaVrE9+gwaGsMF0JZRyAHpfdBEKNshvQ51SK4wjseeh1LKqZtpr+HoWAmwk9tNAddwNiTn4sGDQJdl+AtKNPfiRXNLQPzhvG/GB7fUXS9ydHsAMEAoHAP3w+T5jYJRnoAAAAAElFTkSuQmCC",st="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4CAMAAAAOusbgAAABzlBMVEUAAAAAAAAAgAAAmQAAgAAAkgAAiwAAgAAAiQAAgAAAiAAAhwAAgAAAhgAAgAAAhgAAgAAAhQAAgAAAhQAAgAAAhAAAgAAAhAAAgAAAhAAAgAAAgwAAgAAAgwAAgAAAgwAAgAAAgwAAgAAAgwAAgAAAggAAgAAAgAAAggAAgAAAggAAgAAAgAAAggAAgAAAggAAgAAAggAAgAAAgQAAgQAAgAAAgQAAgAAAgQAAgQAAgAAAgAAAgQAAgAAAgQAAgAAAgQAAgAAAgAAAgQAAgAAAgQAAgQAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgACYS+jrAAAAmXRSTlMAAQQFBgcLDA0ODxESExQVFhcYGRobHB0eHyAhIiMkJSYnKCksLS4wMTI3ODo7PD0+P0xNT1BTVFVXWFpbXl9gYWJmaWprbW6AgYKDhYaHiImKi4yNjo+RkpSXmZqbnJ2foqqtrq+5u7y+xMXGx8jJysvQ0dLT1dbY2drc3d7g4eLj5OXm5+jq6+zt7u/w8fX29/j5+vv8/f5OSOWKAAACyklEQVR4Ae3aA7okSxQE4Bjbtm3bc23btm2b1f1ex25nA1nO813Vv4BCGoGdIBAIBI49/ZVS1dQ5uGAYC4OdTZUpv54eg7TTHwuGqDBZ/vsSxNxJ7qeFvsTbEHA8po22WqKPQ6+LOSt0ZL3gAvS5krNGx0Jlt6DH/pQwXQnnHIIGb8bo2uS3XfDpSh09qb0EX94u0KOlj/BuT0qEnkVy9sKjM230pfkUPLnST5+GbsCDexP0bfohXHu1TA2WX8Cl+4vUYvkRXLk2RU1mbsKFk/3UZvA0HNvXRo2a98KpXGqVCYdeR6hV5B0cuThPzRauwIFdddSuBg58pYBPsHVoggKmDsu3aLUs2LjxH0WEr8FaCYUUwtIFg0JCl2Alj2JyYOHEKsWsHoO5GAqKgrk2CmqGqTsUdQtmkikqHmb6KaoHJs5R2DmofaOwr1ArpbBiqI1Q2BCUjlPcUag8o7gnUPlFcd+hkkpxSVCporgKqDRRXD1UuiiuAyrDFDcElXmKm4WKQXHrG//ijS/qjWxcG9adNmwA2bAhM4XiEqHyk+K+QeUpxT2GylGKO4qN6chDG7W8LdqoBf0XqJ2lrMgZmOilqG6YSaKoOJi5uVEbc7RSUCPMRVPQH5g7vkoxK8dgIZdismHlvEEh6+dgqYhC8mHtWpgiQldgI5si0mHn4DgFTB6Crc8U8AEO1FK7ajhxYY6aLVzeoCu+t1CRb9lpcGpvMzVq2APHTvRSm4FTcOHqJDWZvAJX7ukKJzyESy+XqMHSc7h2d5y+TT2AB1f66NPgdXhyqpm+NJyAR7tj/5ePVam9madHS+/hy6UaelJ9AX69GaVrE9+gwaGsMF0JZRyAHpfdBEKNshvQ51SK4wjseeh1LKqZtpr+HoWAmwk9tNAddwNiTn4sGDQJdl+AtKNPfiRXNLQPzhvG/GB7fUXS9ydHsAMEAoHAP3w+T5jYJRnoAAAAAElFTkSuQmCC",nt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4CAMAAAAOusbgAAABzlBMVEUAAAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AADGIKqbAAAAmXRSTlMAAQQFBgcLDA0ODxESExQVFhcYGRobHB0eHyAhIiMkJSYnKCksLS4wMTI3ODo7PD0+P0xNT1BTVFVXWFpbXl9gYWJmaWprbW6AgYKDhYaHiImKi4yNjo+RkpSXmZqbnJ2foqqtrq+5u7y+xMXGx8jJysvQ0dLT1dbY2drc3d7g4eLj5OXm5+jq6+zt7u/w8fX29/j5+vv8/f5OSOWKAAACyklEQVR4Ae3aA7okSxQE4Bjbtm3bc23btm2b1f1ex25nA1nO813Vv4BCGoGdIBAIBI49/ZVS1dQ5uGAYC4OdTZUpv54eg7TTHwuGqDBZ/vsSxNxJ7qeFvsTbEHA8po22WqKPQ6+LOSt0ZL3gAvS5krNGx0Jlt6DH/pQwXQnnHIIGb8bo2uS3XfDpSh09qb0EX94u0KOlj/BuT0qEnkVy9sKjM230pfkUPLnST5+GbsCDexP0bfohXHu1TA2WX8Cl+4vUYvkRXLk2RU1mbsKFk/3UZvA0HNvXRo2a98KpXGqVCYdeR6hV5B0cuThPzRauwIFdddSuBg58pYBPsHVoggKmDsu3aLUs2LjxH0WEr8FaCYUUwtIFg0JCl2Alj2JyYOHEKsWsHoO5GAqKgrk2CmqGqTsUdQtmkikqHmb6KaoHJs5R2DmofaOwr1ArpbBiqI1Q2BCUjlPcUag8o7gnUPlFcd+hkkpxSVCporgKqDRRXD1UuiiuAyrDFDcElXmKm4WKQXHrG//ijS/qjWxcG9adNmwA2bAhM4XiEqHyk+K+QeUpxT2GylGKO4qN6chDG7W8LdqoBf0XqJ2lrMgZmOilqG6YSaKoOJi5uVEbc7RSUCPMRVPQH5g7vkoxK8dgIZdismHlvEEh6+dgqYhC8mHtWpgiQldgI5si0mHn4DgFTB6Crc8U8AEO1FK7ajhxYY6aLVzeoCu+t1CRb9lpcGpvMzVq2APHTvRSm4FTcOHqJDWZvAJX7ukKJzyESy+XqMHSc7h2d5y+TT2AB1f66NPgdXhyqpm+NJyAR7tj/5ePVam9madHS+/hy6UaelJ9AX69GaVrE9+gwaGsMF0JZRyAHpfdBEKNshvQ51SK4wjseeh1LKqZtpr+HoWAmwk9tNAddwNiTn4sGDQJdl+AtKNPfiRXNLQPzhvG/GB7fUXS9ydHsAMEAoHAP3w+T5jYJRnoAAAAAElFTkSuQmCC";let B=new qe(500),U=new $({store:new _,nodeId:"server:uuid"});new p("server:uuid",U,B.right);U.on("add",(i,e)=>{i.type!=="logux/processed"&&setTimeout(()=>{U.add({type:"logux/processed",id:e.id})},500)});let g=new We({subprotocol:location.hash.slice(1)||"1.0.0",userId:"10",server:"wss://example.com/"}),X=new se(g.node.localNodeId,g.log,B.left);X.connection.url="wss://example.com/";X.emitter=g.node.emitter;g.node=X;Ve(g);ze(g);Ze(g,{normal:st,offline:it,error:nt});Xe(g,{messages:Me,styles:tt});$e(g);ne(g,i=>{document.all.status.innerText=i});let O=0;function ot(i){return i==="disconnected"?"\u{1F634}":i==="connecting"?"\u{1F50C}":"\u{1F60A}"}function rt(i){return i.slice(0,1).toUpperCase()}function H(){document.title=ot(g.state)+" "+rt(g.role)+" "+O}g.on("state",()=>{document.querySelector("#connection").checked=g.connected,H()});g.on("role",()=>{H(),document.querySelector("#connection").disabled=g.role!=="leader"});g.on("add",i=>{i.type==="TICK"&&O++,H()});g.on("clean",i=>{i.type==="TICK"&&O--,H()});g.log.each(i=>{i.type==="TICK"&&O++}).then(()=>{H()});g.on("role",()=>{let i=g.role==="leader";document.all.connection.disabled=!i,document.all.disabled.style.display=i?"none":"inline"});g.start();document.querySelector("#connection").onchange=i=>{i.target.checked?g.node.connection.connect():g.node.connection.disconnect()};document.querySelector("#add").onclick=()=>{g.log.add({type:"TICK"},{reasons:["tick"],sync:!0})};document.querySelector("#clean").onclick=()=>{g.log.removeReason("tick")};document.querySelector("#error").onclick=()=>{setTimeout(()=>{g.log.add({type:"logux/undo",reason:"error",action:{type:"TICK"}})},3e3)};document.querySelector("#denied").onclick=()=>{setTimeout(()=>{g.log.add({type:"logux/undo",reason:"denied",action:{type:"TICK"}})},3e3)};document.querySelector("#serverError").onclick=()=>{setTimeout(()=>{B.right.send(["error","wrong-format"])},3e3)};document.querySelector("#subprotocolError").onclick=()=>{g.node.syncError("wrong-subprotocol",{supported:"2.x",used:"1.0.0"})};g.options.subprotocol==="1.0.1"?document.querySelector("#subprotocolClient").disabled=!0:document.querySelector("#subprotocolClient").onclick=()=>{window.open(location.toString()+"#1.0.1","_blank")};
